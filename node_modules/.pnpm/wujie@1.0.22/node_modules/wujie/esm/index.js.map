{"version":3,"file":"index.js","names":["importHTML","processCssLoader","WuJie","defineWujieWebComponent","addLoading","processAppForHrefJump","getPlugins","wujieSupport","mergeOptions","isFunction","requestIdleCallback","isMatchSyncQueryById","warn","stopMainAppRun","getWujieById","getOptionsById","addSandboxCacheWithOptions","EventBus","WUJIE_TIPS_NOT_SUPPORTED","bus","Date","now","toString","window","__WUJIE","__POWERED_BY_WUJIE__","setupApp","options","name","startApp","_x","_startApp","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","startOptions","_newSandbox$lifecycle","_newSandbox$lifecycle2","sandbox","cacheOptions","url","html","replace","fetch","props","attrs","degradeAttrs","fiber","alive","degrade","sync","prefix","el","loading","plugins","lifecycles","_iframeWindow","_sandbox$lifecycles3","_sandbox$lifecycles3$","_sandbox$lifecycles2","_sandbox$lifecycles2$","_yield$importHTML2","_getExternalScripts","_sandbox$lifecycles4","_sandbox$lifecycles4$","_sandbox$lifecycles5","_sandbox$lifecycles5$","newSandbox","_yield$importHTML3","template","getExternalScripts","getExternalStyleSheets","processedHtml","wrap","_callee2$","_context2","prev","next","iframeWindow","iframe","contentWindow","preload","active","execFlag","beforeLoad","call","opts","loadError","sent","start","activated","abrupt","destroy","__WUJIE_MOUNT","unmount","rebuildStyleSheets","beforeMount","afterMount","mountFlag","stop","preloadApp","preOptions","_objectSpread","exec","runPreload","_ref","_callee","_sandbox$lifecycles","_sandbox$lifecycles$b","_yield$importHTML","_callee$","_context","destroyApp","id"],"sources":["../src/index.ts"],"sourcesContent":["import importHTML, { processCssLoader } from \"./entry\";\nimport { StyleObject, ScriptAttributes } from \"./template\";\nimport WuJie, { lifecycle } from \"./sandbox\";\nimport { defineWujieWebComponent, addLoading } from \"./shadow\";\nimport { processAppForHrefJump } from \"./sync\";\nimport { getPlugins } from \"./plugin\";\nimport {\n  wujieSupport,\n  mergeOptions,\n  isFunction,\n  requestIdleCallback,\n  isMatchSyncQueryById,\n  warn,\n  stopMainAppRun,\n} from \"./utils\";\nimport { getWujieById, getOptionsById, addSandboxCacheWithOptions } from \"./common\";\nimport { EventBus } from \"./event\";\nimport { WUJIE_TIPS_NOT_SUPPORTED } from \"./constant\";\n\nexport const bus = new EventBus(Date.now().toString());\n\nexport interface ScriptObjectLoader {\n  /** 脚本地址，内联为空 */\n  src?: string;\n  /** 脚本是否为module模块 */\n  module?: boolean;\n  /** 脚本是否为async执行 */\n  async?: boolean;\n  /** 脚本是否设置crossorigin */\n  crossorigin?: boolean;\n  /** 脚本crossorigin的类型 */\n  crossoriginType?: \"anonymous\" | \"use-credentials\" | \"\";\n  /** 脚本原始属性 */\n  attrs?: ScriptAttributes;\n  /** 内联script的代码 */\n  content?: string;\n  /** 执行回调钩子 */\n  callback?: (appWindow: Window) => any;\n  /** 子应用加载完毕事件 */\n  onload?: Function;\n}\nexport interface plugin {\n  /** 处理html的loader */\n  htmlLoader?: (code: string) => string;\n  /** js排除列表 */\n  jsExcludes?: Array<string | RegExp>;\n  /** js忽略列表 */\n  jsIgnores?: Array<string | RegExp>;\n  /** 处理js加载前的loader */\n  jsBeforeLoaders?: Array<ScriptObjectLoader>;\n  /** 处理js的loader */\n  jsLoader?: (code: string, url: string, base: string) => string;\n  /** 处理js加载后的loader */\n  jsAfterLoaders?: Array<ScriptObjectLoader>;\n  /** css排除列表 */\n  cssExcludes?: Array<string | RegExp>;\n  /** css忽略列表 */\n  cssIgnores?: Array<string | RegExp>;\n  /** 处理css加载前的loader */\n  cssBeforeLoaders?: Array<StyleObject>;\n  /** 处理css的loader */\n  cssLoader?: (code: string, url: string, base: string) => string;\n  /** 处理css加载后的loader */\n  cssAfterLoaders?: Array<StyleObject>;\n  /** 子应用 window addEventListener 钩子回调 */\n  windowAddEventListenerHook?: eventListenerHook;\n  /** 子应用 window removeEventListener 钩子回调 */\n  windowRemoveEventListenerHook?: eventListenerHook;\n  /** 子应用 document addEventListener 钩子回调 */\n  documentAddEventListenerHook?: eventListenerHook;\n  /** 子应用 document removeEventListener 钩子回调 */\n  documentRemoveEventListenerHook?: eventListenerHook;\n  /** 子应用 向body、head插入元素后执行的钩子回调 */\n  appendOrInsertElementHook?: <T extends Node>(element: T, iframeWindow: Window) => void;\n  /** 子应用劫持元素的钩子回调 */\n  patchElementHook?: <T extends Node>(element: T, iframeWindow: Window) => void;\n  /** 用户自定义覆盖子应用 window 属性 */\n  windowPropertyOverride?: (iframeWindow: Window) => void;\n  /** 用户自定义覆盖子应用 document 属性 */\n  documentPropertyOverride?: (iframeWindow: Window) => void;\n}\n\ntype eventListenerHook = (\n  iframeWindow: Window,\n  type: string,\n  handler: EventListenerOrEventListenerObject,\n  options?: boolean | AddEventListenerOptions\n) => void;\n\nexport type loadErrorHandler = (url: string, e: Error) => any;\n\ntype baseOptions = {\n  /** 唯一性用户必须保证 */\n  name: string;\n  /** 需要渲染的url */\n  url: string;\n  /** 需要渲染的html, 如果已有则无需从url请求 */\n  html?: string;\n  /** 代码替换钩子 */\n  replace?: (code: string) => string;\n  /** 自定义fetch */\n  fetch?: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\n  /** 注入给子应用的属性 */\n  props?: { [key: string]: any };\n  /** 自定义运行iframe的属性 */\n  attrs?: { [key: string]: any };\n  /** 自定义降级渲染iframe的属性 */\n  degradeAttrs?: { [key: string]: any };\n  /** 子应用采用fiber模式执行 */\n  fiber?: boolean;\n  /** 子应用保活，state不会丢失 */\n  alive?: boolean;\n  /** 子应用采用降级iframe方案 */\n  degrade?: boolean;\n  /** 子应用插件 */\n  plugins?: Array<plugin>;\n  /** 子应用生命周期 */\n  beforeLoad?: lifecycle;\n  beforeMount?: lifecycle;\n  afterMount?: lifecycle;\n  beforeUnmount?: lifecycle;\n  afterUnmount?: lifecycle;\n  activated?: lifecycle;\n  deactivated?: lifecycle;\n  loadError?: loadErrorHandler;\n};\n\nexport type preOptions = baseOptions & {\n  /** 预执行 */\n  exec?: boolean;\n};\n\nexport type startOptions = baseOptions & {\n  /** 渲染的容器 */\n  el: HTMLElement | string;\n  /**\n   * 路由同步开关\n   * 如果false，子应用跳转主应用路由无变化，但是主应用的history还是会增加\n   * https://html.spec.whatwg.org/multipage/history.html#the-history-interface\n   */\n  sync?: boolean;\n  /** 子应用短路径替换，路由同步时生效 */\n  prefix?: { [key: string]: string };\n  /** 子应用加载时loading元素 */\n  loading?: HTMLElement;\n};\n\ntype optionProperty = \"url\" | \"el\";\n\n/**\n * 合并 preOptions 和 startOptions，并且将 url 和 el 变成可选\n */\nexport type cacheOptions = Omit<preOptions & startOptions, optionProperty> &\n  Partial<Pick<startOptions, optionProperty>>;\n\n/**\n * 强制中断主应用运行\n * wujie.__WUJIE 如果为true说明当前运行环境是子应用\n * window.__POWERED_BY_WUJIE__ 如果为false说明子应用还没初始化完成\n * 上述条件同时成立说明主应用代码在iframe的loading阶段混入进来了，必须中断执行\n */\nif (window.__WUJIE && !window.__POWERED_BY_WUJIE__) {\n  stopMainAppRun();\n}\n\n// 处理子应用链接跳转\nprocessAppForHrefJump();\n\n// 定义webComponent容器\ndefineWujieWebComponent();\n\n// 如果不支持则告警\nif (!wujieSupport) warn(WUJIE_TIPS_NOT_SUPPORTED);\n\n/**\n * 缓存子应用配置\n */\nexport function setupApp(options: cacheOptions): void {\n  if (options.name) addSandboxCacheWithOptions(options.name, options);\n}\n\n/**\n * 运行无界app\n */\nexport async function startApp(startOptions: startOptions): Promise<Function | void> {\n  const sandbox = getWujieById(startOptions.name);\n  const cacheOptions = getOptionsById(startOptions.name);\n  // 合并缓存配置\n  const options = mergeOptions(startOptions, cacheOptions);\n  const {\n    name,\n    url,\n    html,\n    replace,\n    fetch,\n    props,\n    attrs,\n    degradeAttrs,\n    fiber,\n    alive,\n    degrade,\n    sync,\n    prefix,\n    el,\n    loading,\n    plugins,\n    lifecycles,\n  } = options;\n  // 已经初始化过的应用，快速渲染\n  if (sandbox) {\n    sandbox.plugins = getPlugins(plugins);\n    sandbox.lifecycles = lifecycles;\n    const iframeWindow = sandbox.iframe.contentWindow;\n    if (sandbox.preload) {\n      await sandbox.preload;\n    }\n    if (alive) {\n      // 保活\n      await sandbox.active({ url, sync, prefix, el, props, alive, fetch, replace });\n      // 预加载但是没有执行的情况\n      if (!sandbox.execFlag) {\n        sandbox.lifecycles?.beforeLoad?.(sandbox.iframe.contentWindow);\n        const { getExternalScripts } = await importHTML({\n          url,\n          html,\n          opts: {\n            fetch: fetch || window.fetch,\n            plugins: sandbox.plugins,\n            loadError: sandbox.lifecycles.loadError,\n            fiber,\n          },\n        });\n        await sandbox.start(getExternalScripts);\n      }\n      sandbox.lifecycles?.activated?.(sandbox.iframe.contentWindow);\n      return sandbox.destroy;\n    } else if (isFunction(iframeWindow.__WUJIE_MOUNT)) {\n      /**\n       * 子应用切换会触发webcomponent的disconnectedCallback调用sandbox.unmount进行实例销毁\n       * 此处是防止没有销毁webcomponent时调用startApp的情况，需要手动调用unmount\n       */\n      sandbox.unmount();\n      await sandbox.active({ url, sync, prefix, el, props, alive, fetch, replace });\n      // 正常加载的情况，先注入css，最后才mount。重新激活也保持同样的时序\n      sandbox.rebuildStyleSheets();\n      // 有渲染函数\n      sandbox.lifecycles?.beforeMount?.(sandbox.iframe.contentWindow);\n      iframeWindow.__WUJIE_MOUNT();\n      sandbox.lifecycles?.afterMount?.(sandbox.iframe.contentWindow);\n      sandbox.mountFlag = true;\n      return sandbox.destroy;\n    } else {\n      // 没有渲染函数\n      sandbox.destroy();\n    }\n  }\n\n  // 设置loading\n  addLoading(el, loading);\n  const newSandbox = new WuJie({ name, url, attrs, degradeAttrs, fiber, degrade, plugins, lifecycles });\n  newSandbox.lifecycles?.beforeLoad?.(newSandbox.iframe.contentWindow);\n  const { template, getExternalScripts, getExternalStyleSheets } = await importHTML({\n    url,\n    html,\n    opts: {\n      fetch: fetch || window.fetch,\n      plugins: newSandbox.plugins,\n      loadError: newSandbox.lifecycles.loadError,\n      fiber,\n    },\n  });\n\n  const processedHtml = await processCssLoader(newSandbox, template, getExternalStyleSheets);\n  await newSandbox.active({ url, sync, prefix, template: processedHtml, el, props, alive, fetch, replace });\n  await newSandbox.start(getExternalScripts);\n  return newSandbox.destroy;\n}\n\n/**\n * 预加载无界APP\n */\nexport function preloadApp(preOptions: preOptions): void {\n  requestIdleCallback((): void | Promise<void> => {\n    /**\n     * 已经存在\n     * url查询参数中有子应用的id，大概率是刷新浏览器或者分享url，此时需要直接打开子应用，无需预加载\n     */\n    if (getWujieById(preOptions.name) || isMatchSyncQueryById(preOptions.name)) return;\n    const cacheOptions = getOptionsById(preOptions.name);\n    // 合并缓存配置\n    const options = mergeOptions({ ...preOptions }, cacheOptions);\n    const {\n      name,\n      url,\n      html,\n      props,\n      alive,\n      replace,\n      fetch,\n      exec,\n      attrs,\n      degradeAttrs,\n      fiber,\n      degrade,\n      prefix,\n      plugins,\n      lifecycles,\n    } = options;\n\n    const sandbox = new WuJie({ name, url, attrs, degradeAttrs, fiber, degrade, plugins, lifecycles });\n    if (sandbox.preload) return sandbox.preload;\n    const runPreload = async () => {\n      sandbox.lifecycles?.beforeLoad?.(sandbox.iframe.contentWindow);\n      const { template, getExternalScripts, getExternalStyleSheets } = await importHTML({\n        url,\n        html,\n        opts: {\n          fetch: fetch || window.fetch,\n          plugins: sandbox.plugins,\n          loadError: sandbox.lifecycles.loadError,\n          fiber,\n        },\n      });\n      const processedHtml = await processCssLoader(sandbox, template, getExternalStyleSheets);\n      await sandbox.active({ url, props, prefix, alive, template: processedHtml, fetch, replace });\n      if (exec) {\n        await sandbox.start(getExternalScripts);\n      } else {\n        await getExternalScripts();\n      }\n    };\n    sandbox.preload = runPreload();\n  });\n}\n\n/**\n * 销毁无界APP\n */\nexport function destroyApp(id: string): void {\n  const sandbox = getWujieById(id);\n  if (sandbox) {\n    sandbox.destroy();\n  }\n}\n"],"mappings":"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"}