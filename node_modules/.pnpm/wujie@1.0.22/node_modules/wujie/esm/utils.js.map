{"version":3,"file":"utils.js","names":["WUJIE_SCRIPT_ID","WUJIE_TIPS_NO_URL","WUJIE_APP_ID","WUJIE_TIPS_STOP_APP","WUJIE_TIPS_STOP_APP_DETAIL","toArray","array","Array","isArray","isFunction","value","isHijackingTag","tagName","toUpperCase","wujieSupport","window","Proxy","CustomElementRegistry","naughtySafari","document","all","callableFnCacheMap","WeakMap","isCallable","fn","has","callable","set","boundedMap","isBoundedFunction","get","bounded","name","indexOf","hasOwnProperty","fnRegexCheckCacheMap","isConstructable","hasPrototypeMethods","prototype","constructor","Object","getOwnPropertyNames","length","constructable","fnString","toString","constructableFunctionRegex","classRegex","test","setFnCacheMap","checkProxyFunction","getTargetValue","target","p","boundValue","Function","bind","call","key","defineProperty","enumerable","writable","getDegradeIframe","id","querySelector","concat","setAttrsToElement","element","attrs","keys","forEach","setAttribute","appRouteParse","url","error","Error","urlElement","anchorElementGenerator","appHostPath","protocol","host","appRoutePath","pathname","search","hash","startsWith","createElement","href","getAnchorElementQueryMap","anchorElement","queryList","replace","split","queryMap","query","_query$split","_query$split2","_slicedToArray","isMatchSyncQueryById","location","includes","fixElementCtrSrcOrHref","iframeWindow","elementCtr","attr","rawElementSetAttribute","Element","targetValue","getAbsolutePath","baseURI","rawAnchorElementHrefDescriptor","getOwnPropertyDescriptor","configurable","getCurUrl","proxyLocation","base","URL","_unused","getSyncUrl","prefix","_syncUrl$match","winUrlElement","syncUrl","decodeURIComponent","validShortPath","match","requestIdleCallback","cb","setTimeout","getContainer","container","warn","msg","data","_console","console","_console2","getInlineCode","start","end","lastIndexOf","substring","defaultGetPublicPath","entry","_typeof","_URL","origin","paths","pop","join","e","compose","fnList","code","_len","arguments","args","_key2","reduce","newCode","apply","nextTick","Promise","resolve","then","execHooks","plugins","hookName","_len2","_key3","map","plugin","filter","hook","isScriptElement","_element$tagName","count","setTagToScript","tag","scriptTag","String","getTagFromScript","getAttribute","mergeOptions","options","cacheOptions","el","html","exec","undefined","fetch","props","sync","loading","degradeAttrs","fiber","alive","degrade","lifecycles","beforeLoad","beforeMount","afterMount","beforeUnmount","afterUnmount","activated","deactivated","loadError","eventTrigger","eventName","detail","event","CustomEvent","createEvent","initCustomEvent","dispatchEvent","stopMainAppRun"],"sources":["../src/utils.ts"],"sourcesContent":["import {\n  WUJIE_SCRIPT_ID,\n  WUJIE_TIPS_NO_URL,\n  WUJIE_APP_ID,\n  WUJIE_TIPS_STOP_APP,\n  WUJIE_TIPS_STOP_APP_DETAIL,\n} from \"./constant\";\nimport { plugin, cacheOptions } from \"./index\";\n\nexport function toArray<T>(array: T | T[]): T[] {\n  return Array.isArray(array) ? array : [array];\n}\n\nexport function isFunction(value: any): boolean {\n  return typeof value === \"function\";\n}\n\nexport function isHijackingTag(tagName?: string) {\n  return (\n    tagName?.toUpperCase() === \"LINK\" ||\n    tagName?.toUpperCase() === \"STYLE\" ||\n    tagName?.toUpperCase() === \"SCRIPT\" ||\n    tagName?.toUpperCase() === \"IFRAME\"\n  );\n}\n\nexport const wujieSupport = window.Proxy && window.CustomElementRegistry;\n\n/**\n * in safari\n * typeof document.all === 'undefined' // true\n * typeof document.all === 'function' // true\n * We need to discriminate safari for better performance\n */\nconst naughtySafari = typeof document.all === \"function\" && typeof document.all === \"undefined\";\nconst callableFnCacheMap = new WeakMap<CallableFunction, boolean>();\nexport const isCallable = (fn: any) => {\n  if (callableFnCacheMap.has(fn)) {\n    return true;\n  }\n\n  const callable = naughtySafari ? typeof fn === \"function\" && typeof fn !== \"undefined\" : typeof fn === \"function\";\n  if (callable) {\n    callableFnCacheMap.set(fn, callable);\n  }\n  return callable;\n};\n\nconst boundedMap = new WeakMap<CallableFunction, boolean>();\nexport function isBoundedFunction(fn: CallableFunction) {\n  if (boundedMap.has(fn)) {\n    return boundedMap.get(fn);\n  }\n  const bounded = fn.name.indexOf(\"bound \") === 0 && !fn.hasOwnProperty(\"prototype\");\n  boundedMap.set(fn, bounded);\n  return bounded;\n}\n\nconst fnRegexCheckCacheMap = new WeakMap<any | FunctionConstructor, boolean>();\nexport function isConstructable(fn: () => any | FunctionConstructor) {\n  const hasPrototypeMethods =\n    fn.prototype && fn.prototype.constructor === fn && Object.getOwnPropertyNames(fn.prototype).length > 1;\n\n  if (hasPrototypeMethods) return true;\n\n  if (fnRegexCheckCacheMap.has(fn)) {\n    return fnRegexCheckCacheMap.get(fn);\n  }\n\n  let constructable = hasPrototypeMethods;\n  if (!constructable) {\n    const fnString = fn.toString();\n    const constructableFunctionRegex = /^function\\b\\s[A-Z].*/;\n    const classRegex = /^class\\b/;\n    constructable = constructableFunctionRegex.test(fnString) || classRegex.test(fnString);\n  }\n\n  fnRegexCheckCacheMap.set(fn, constructable);\n  return constructable;\n}\n\nconst setFnCacheMap = new WeakMap<CallableFunction, CallableFunction>();\nexport function checkProxyFunction(value: any) {\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\n    if (!setFnCacheMap.has(value)) {\n      setFnCacheMap.set(value, value);\n    }\n  }\n}\n\nexport function getTargetValue(target: any, p: any): any {\n  const value = target[p];\n  if (setFnCacheMap.has(value)) {\n    return setFnCacheMap.get(value);\n  }\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\n    const boundValue = Function.prototype.bind.call(value, target);\n    setFnCacheMap.set(value, boundValue);\n\n    for (const key in value) {\n      boundValue[key] = value[key];\n    }\n    if (value.hasOwnProperty(\"prototype\") && !boundValue.hasOwnProperty(\"prototype\")) {\n      // https://github.com/kuitos/kuitos.github.io/issues/47\n      Object.defineProperty(boundValue, \"prototype\", { value: value.prototype, enumerable: false, writable: true });\n    }\n    return boundValue;\n  }\n  return value;\n}\n\nexport function getDegradeIframe(id: string): HTMLIFrameElement {\n  return window.document.querySelector(`iframe[${WUJIE_APP_ID}=\"${id}\"]`);\n}\n\nexport function setAttrsToElement(element: HTMLElement, attrs: { [key: string]: any }) {\n  Object.keys(attrs).forEach((name) => {\n    element.setAttribute(name, attrs[name]);\n  });\n}\n\nexport function appRouteParse(url: string): {\n  urlElement: HTMLAnchorElement;\n  appHostPath: string;\n  appRoutePath: string;\n} {\n  if (!url) {\n    error(WUJIE_TIPS_NO_URL);\n    throw new Error();\n  }\n  const urlElement = anchorElementGenerator(url);\n  const appHostPath = urlElement.protocol + \"//\" + urlElement.host;\n  let appRoutePath = urlElement.pathname + urlElement.search + urlElement.hash;\n  if (!appRoutePath.startsWith(\"/\")) appRoutePath = \"/\" + appRoutePath; // hack ie\n  return { urlElement, appHostPath, appRoutePath };\n}\n\nexport function anchorElementGenerator(url: string): HTMLAnchorElement {\n  const element = window.document.createElement(\"a\");\n  element.href = url;\n  element.href = element.href; // hack ie\n  return element;\n}\n\nexport function getAnchorElementQueryMap(anchorElement: HTMLAnchorElement): { [key: string]: string } {\n  const queryList = anchorElement.search.replace(\"?\", \"\").split(\"&\");\n  const queryMap = {};\n  queryList.forEach((query) => {\n    const [key, value] = query.split(\"=\");\n    if (key && value) queryMap[key] = value;\n  });\n  return queryMap;\n}\n\n/**\n * 当前url的查询参数中是否有给定的id\n */\nexport function isMatchSyncQueryById(id: string): boolean {\n  const queryMap = getAnchorElementQueryMap(anchorElementGenerator(window.location.href));\n  return Object.keys(queryMap).includes(id);\n}\n\n/**\n * 劫持元素原型对相对地址的赋值转绝对地址\n * @param iframeWindow\n */\nexport function fixElementCtrSrcOrHref(\n  iframeWindow: Window,\n  elementCtr:\n    | typeof HTMLImageElement\n    | typeof HTMLAnchorElement\n    | typeof HTMLSourceElement\n    | typeof HTMLLinkElement\n    | typeof HTMLScriptElement\n    | typeof HTMLMediaElement,\n  attr\n): void {\n  // patch setAttribute\n  const rawElementSetAttribute = iframeWindow.Element.prototype.setAttribute;\n  elementCtr.prototype.setAttribute = function (name: string, value: string): void {\n    let targetValue = value;\n    if (name === attr) targetValue = getAbsolutePath(value, this.baseURI || \"\", true);\n    rawElementSetAttribute.call(this, name, targetValue);\n  };\n  // patch href get and set\n  const rawAnchorElementHrefDescriptor = Object.getOwnPropertyDescriptor(elementCtr.prototype, attr);\n  const { enumerable, configurable, get, set } = rawAnchorElementHrefDescriptor;\n  Object.defineProperty(elementCtr.prototype, attr, {\n    enumerable,\n    configurable,\n    get: function () {\n      return get.call(this);\n    },\n    set: function (href) {\n      set.call(this, getAbsolutePath(href, this.baseURI, true));\n    },\n  });\n  // TODO: innerHTML的处理\n}\n\nexport function getCurUrl(proxyLocation: Object): string {\n  const location = proxyLocation as Location;\n  return location.protocol + \"//\" + location.host + location.pathname;\n}\n\nexport function getAbsolutePath(url: string, base: string, hash?: boolean): string {\n  try {\n    // 为空值无需处理\n    if (url) {\n      // 需要处理hash的场景\n      if (hash && url.startsWith(\"#\")) return url;\n      return new URL(url, base).href;\n    } else return url;\n  } catch {\n    return url;\n  }\n}\n/**\n * 获取需要同步的url\n */\nexport function getSyncUrl(id: string, prefix: { [key: string]: string }): string {\n  let winUrlElement = anchorElementGenerator(window.location.href);\n  const queryMap = getAnchorElementQueryMap(winUrlElement);\n  winUrlElement = null;\n  const syncUrl = window.decodeURIComponent(queryMap[id] || \"\");\n  const validShortPath = syncUrl.match(/^{([^}]*)}/)?.[1];\n  if (prefix && validShortPath) {\n    return syncUrl.replace(`{${validShortPath}}`, prefix[validShortPath]);\n  }\n  return syncUrl;\n}\n// @ts-ignore\nexport const requestIdleCallback = window.requestIdleCallback || ((cb: Function) => setTimeout(cb, 1));\n\nexport function getContainer(container: string | HTMLElement): HTMLElement {\n  return typeof container === \"string\" ? (document.querySelector(container) as HTMLElement) : container;\n}\n\nexport function warn(msg: string, data?: any): void {\n  console?.warn(`[wujie warn]: ${msg}`, data);\n}\n\nexport function error(msg: string, data?: any): void {\n  console?.error(`[wujie error]: ${msg}`, data);\n}\n\nexport function getInlineCode(match) {\n  const start = match.indexOf(\">\") + 1;\n  const end = match.lastIndexOf(\"<\");\n  return match.substring(start, end);\n}\n\nexport function defaultGetPublicPath(entry) {\n  if (typeof entry === \"object\") {\n    return \"/\";\n  }\n  try {\n    const { origin, pathname } = new URL(entry, location.href);\n    const paths = pathname.split(\"/\");\n    // 移除最后一个元素\n    paths.pop();\n    return `${origin}${paths.join(\"/\")}/`;\n  } catch (e) {\n    console.warn(e);\n    return \"\";\n  }\n}\n\n/** [f1, f2, f3, f4] => f4(f3(f2(f1))) 函数柯里化 */\nexport function compose(fnList: Array<Function>): (...args: Array<string>) => string {\n  return function (code: string, ...args: Array<any>) {\n    return fnList.reduce((newCode, fn) => (isFunction(fn) ? fn(newCode, ...args) : newCode), code || \"\");\n  };\n}\n\n// 微任务\nexport function nextTick(cb: () => any): void {\n  Promise.resolve().then(cb);\n}\n\n//执行钩子函数\nexport function execHooks(plugins: Array<plugin>, hookName: string, ...args: Array<any>): void {\n  try {\n    if (plugins && plugins.length > 0) {\n      plugins\n        .map((plugin) => plugin[hookName])\n        .filter((hook) => isFunction(hook))\n        .forEach((hook) => hook(...args));\n    }\n  } catch (e) {\n    error(e);\n  }\n}\n\nexport function isScriptElement(element: HTMLElement): boolean {\n  return element.tagName?.toUpperCase() === \"SCRIPT\";\n}\n\nlet count = 1;\nexport function setTagToScript(element: HTMLScriptElement, tag?: string): void {\n  if (isScriptElement(element)) {\n    const scriptTag = tag || String(count++);\n    element.setAttribute(WUJIE_SCRIPT_ID, scriptTag);\n  }\n}\n\nexport function getTagFromScript(element: HTMLScriptElement): string | null {\n  if (isScriptElement(element)) {\n    return element.getAttribute(WUJIE_SCRIPT_ID);\n  }\n  return null;\n}\n\n// 合并缓存\nexport function mergeOptions(options: cacheOptions, cacheOptions: cacheOptions) {\n  return {\n    name: options.name,\n    el: options.el || cacheOptions?.el,\n    url: options.url || cacheOptions?.url,\n    html: options.html || cacheOptions?.html,\n    exec: options.exec !== undefined ? options.exec : cacheOptions?.exec,\n    replace: options.replace || cacheOptions?.replace,\n    fetch: options.fetch || cacheOptions?.fetch,\n    props: options.props || cacheOptions?.props,\n    sync: options.sync !== undefined ? options.sync : cacheOptions?.sync,\n    prefix: options.prefix || cacheOptions?.prefix,\n    loading: options.loading || cacheOptions?.loading,\n    // 默认 {}\n    attrs: options.attrs !== undefined ? options.attrs : cacheOptions?.attrs || {},\n    degradeAttrs: options.degradeAttrs !== undefined ? options.degradeAttrs : cacheOptions?.degradeAttrs || {},\n    // 默认 true\n    fiber: options.fiber !== undefined ? options.fiber : cacheOptions?.fiber !== undefined ? cacheOptions?.fiber : true,\n    alive: options.alive !== undefined ? options.alive : cacheOptions?.alive,\n    degrade: options.degrade !== undefined ? options.degrade : cacheOptions?.degrade,\n    plugins: options.plugins || cacheOptions?.plugins,\n    lifecycles: {\n      beforeLoad: options.beforeLoad || cacheOptions?.beforeLoad,\n      beforeMount: options.beforeMount || cacheOptions?.beforeMount,\n      afterMount: options.afterMount || cacheOptions?.afterMount,\n      beforeUnmount: options.beforeUnmount || cacheOptions?.beforeUnmount,\n      afterUnmount: options.afterUnmount || cacheOptions?.afterUnmount,\n      activated: options.activated || cacheOptions?.activated,\n      deactivated: options.deactivated || cacheOptions?.deactivated,\n      loadError: options.loadError || cacheOptions?.loadError,\n    },\n  };\n}\n\n/**\n * 事件触发器\n */\nexport function eventTrigger(el: HTMLElement | Window | Document, eventName: string, detail?: any) {\n  let event;\n  if (typeof window.CustomEvent === \"function\") {\n    event = new CustomEvent(eventName, { detail });\n  } else {\n    event = document.createEvent(\"CustomEvent\");\n    event.initCustomEvent(eventName, true, false, detail);\n  }\n  el.dispatchEvent(event);\n}\n\nexport function stopMainAppRun() {\n  warn(WUJIE_TIPS_STOP_APP_DETAIL);\n  throw new Error(WUJIE_TIPS_STOP_APP);\n}\n"],"mappings":"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"}