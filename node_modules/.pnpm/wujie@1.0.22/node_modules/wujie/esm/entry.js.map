{"version":3,"file":"entry.js","names":["processTpl","genLinkReplaceSymbol","getInlineStyleReplaceSymbol","defaultGetPublicPath","getInlineCode","requestIdleCallback","error","compose","getCurUrl","WUJIE_TIPS_NO_FETCH","WUJIE_TIPS_SCRIPT_ERROR_REQUESTED","WUJIE_TIPS_CSS_ERROR_REQUESTED","WUJIE_TIPS_HTML_ERROR_REQUESTED","getEffectLoaders","isMatchUrl","styleCache","scriptCache","embedHTMLCache","window","fetch","Error","defaultFetch","bind","defaultGetTemplate","tpl","processCssLoader","_x","_x2","_x3","_processCssLoader","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","sandbox","template","getExternalStyleSheets","curUrl","composeCssLoader","processedCssList","embedHTML","wrap","_callee$","_context","prev","next","proxyLocation","plugins","map","plugin","cssLoader","_ref2","src","ignore","contentPromise","then","content","getEmbedHTML","sent","abrupt","replace","stop","_x4","_x5","_getEmbedHTML","_callee2","styleResultList","_callee2$","_context2","Promise","all","styleResult","index","concat","isInlineCode","code","startsWith","fetchAssets","cache","cssFlag","loadError","response","status","text","e","styles","length","undefined","_ref","resolve","_getExternalStyleSheets","getExternalScripts","scripts","fiber","script","async","defer","module","reject","_objectSpread","_getExternalScripts","importHTML","params","_opts$fetch","_opts$fiber","url","opts","html","htmlLoader","jsExcludes","cssExcludes","jsIgnores","cssIgnores","getPublicPath","getHtmlParseResult","assetPublicPath","_processTpl","filter","style","some"],"sources":["../src/entry.ts"],"sourcesContent":["import processTpl, {\n  genLinkReplaceSymbol,\n  getInlineStyleReplaceSymbol,\n  ScriptObject,\n  ScriptBaseObject,\n  StyleObject,\n} from \"./template\";\nimport { defaultGetPublicPath, getInlineCode, requestIdleCallback, error, compose, getCurUrl } from \"./utils\";\nimport {\n  WUJIE_TIPS_NO_FETCH,\n  WUJIE_TIPS_SCRIPT_ERROR_REQUESTED,\n  WUJIE_TIPS_CSS_ERROR_REQUESTED,\n  WUJIE_TIPS_HTML_ERROR_REQUESTED,\n} from \"./constant\";\nimport { getEffectLoaders, isMatchUrl } from \"./plugin\";\nimport Wujie from \"./sandbox\";\nimport { plugin, loadErrorHandler } from \"./index\";\n\nexport type ScriptResultList = (ScriptBaseObject & { contentPromise: Promise<string> })[];\nexport type StyleResultList = { src: string; contentPromise: Promise<string>; ignore?: boolean }[];\n\ninterface htmlParseResult {\n  template: string;\n\n  assetPublicPath: string;\n\n  getExternalScripts(): ScriptResultList;\n\n  getExternalStyleSheets(): StyleResultList;\n}\n\ntype ImportEntryOpts = {\n  fetch?: typeof window.fetch;\n  fiber?: boolean;\n  plugins?: Array<plugin>;\n  loadError?: loadErrorHandler;\n};\n\nconst styleCache = {};\nconst scriptCache = {};\nconst embedHTMLCache = {};\n\nif (!window.fetch) {\n  error(WUJIE_TIPS_NO_FETCH);\n  throw new Error();\n}\nconst defaultFetch = window.fetch.bind(window);\n\nfunction defaultGetTemplate(tpl) {\n  return tpl;\n}\n\n/**\n * 处理css-loader\n */\nexport async function processCssLoader(\n  sandbox: Wujie,\n  template: string,\n  getExternalStyleSheets: () => StyleResultList\n): Promise<string> {\n  const curUrl = getCurUrl(sandbox.proxyLocation);\n  /** css-loader */\n  const composeCssLoader = compose(sandbox.plugins.map((plugin) => plugin.cssLoader));\n  const processedCssList: StyleResultList = getExternalStyleSheets().map(({ src, ignore, contentPromise }) => ({\n    src,\n    ignore,\n    contentPromise: contentPromise.then((content) => composeCssLoader(content, src, curUrl)),\n  }));\n  const embedHTML = await getEmbedHTML(template, processedCssList);\n  return sandbox.replace ? sandbox.replace(embedHTML) : embedHTML;\n}\n\n/**\n * convert external css link to inline style for performance optimization\n * @return embedHTML\n */\nasync function getEmbedHTML(template, styleResultList: StyleResultList): Promise<string> {\n  let embedHTML = template;\n\n  return Promise.all(\n    styleResultList.map((styleResult, index) =>\n      styleResult.contentPromise.then((content) => {\n        if (styleResult.src) {\n          embedHTML = embedHTML.replace(\n            genLinkReplaceSymbol(styleResult.src),\n            styleResult.ignore\n              ? `<link href=\"${styleResult.src}\" rel=\"stylesheet\" type=\"text/css\">`\n              : `<style>/* ${styleResult.src} */${content}</style>`\n          );\n        } else if (content) {\n          embedHTML = embedHTML.replace(\n            getInlineStyleReplaceSymbol(index),\n            `<style>/* inline-style-${index} */${content}</style>`\n          );\n        }\n      })\n    )\n  ).then(() => embedHTML);\n}\n\nconst isInlineCode = (code) => code.startsWith(\"<\");\n\nconst fetchAssets = (\n  src: string,\n  cache: Object,\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response>,\n  cssFlag?: boolean,\n  loadError?: loadErrorHandler\n) =>\n  cache[src] ||\n  (cache[src] = fetch(src)\n    .then((response) => {\n      // usually browser treats 4xx and 5xx response of script loading as an error and will fire a script error event\n      // https://stackoverflow.com/questions/5625420/what-http-headers-responses-trigger-the-onerror-handler-on-a-script-tag/5625603\n      if (response.status >= 400) {\n        cache[src] = null;\n        if (cssFlag) {\n          error(WUJIE_TIPS_CSS_ERROR_REQUESTED, { src, response });\n          loadError?.(src, new Error(WUJIE_TIPS_CSS_ERROR_REQUESTED));\n          return \"\";\n        } else {\n          error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED, { src, response });\n          loadError?.(src, new Error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED));\n          throw new Error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED);\n        }\n      }\n      return response.text();\n    })\n    .catch((e) => {\n      cache[src] = null;\n      if (cssFlag) {\n        error(WUJIE_TIPS_CSS_ERROR_REQUESTED, src);\n        loadError?.(src, e);\n        return \"\";\n      } else {\n        error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED, src);\n        loadError?.(src, e);\n        return \"\";\n      }\n    }));\n\n// for prefetch\nexport function getExternalStyleSheets(\n  styles: StyleObject[],\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> = defaultFetch,\n  loadError: loadErrorHandler\n): StyleResultList {\n  return styles.map(({ src, content, ignore }) => {\n    // 内联\n    if (content) {\n      return { src: \"\", contentPromise: Promise.resolve(content) };\n    } else if (isInlineCode(src)) {\n      // if it is inline style\n      return { src: \"\", contentPromise: Promise.resolve(getInlineCode(src)) };\n    } else {\n      // external styles\n      return {\n        src,\n        ignore,\n        contentPromise: ignore ? Promise.resolve(\"\") : fetchAssets(src, styleCache, fetch, true, loadError),\n      };\n    }\n  });\n}\n\n// for prefetch\nexport function getExternalScripts(\n  scripts: ScriptObject[],\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> = defaultFetch,\n  loadError: loadErrorHandler,\n  fiber: boolean\n): ScriptResultList {\n  // module should be requested in iframe\n  return scripts.map((script) => {\n    const { src, async, defer, module, ignore } = script;\n    let contentPromise = null;\n    // async\n    if ((async || defer) && src && !module) {\n      contentPromise = new Promise((resolve, reject) =>\n        fiber\n          ? requestIdleCallback(() => fetchAssets(src, scriptCache, fetch, false, loadError).then(resolve, reject))\n          : fetchAssets(src, scriptCache, fetch, false, loadError).then(resolve, reject)\n      );\n      // module || ignore\n    } else if ((module && src) || ignore) {\n      contentPromise = Promise.resolve(\"\");\n      // inline\n    } else if (!src) {\n      contentPromise = Promise.resolve(script.content);\n      // outline\n    } else {\n      contentPromise = fetchAssets(src, scriptCache, fetch, false, loadError);\n    }\n    // refer https://html.spec.whatwg.org/multipage/scripting.html#attr-script-defer\n    if (module && !async) script.defer = true;\n    return { ...script, contentPromise };\n  });\n}\n\nexport default function importHTML(params: {\n  url: string;\n  html?: string;\n  opts: ImportEntryOpts;\n}): Promise<htmlParseResult> {\n  const { url, opts, html } = params;\n  const fetch = opts.fetch ?? defaultFetch;\n  const fiber = opts.fiber ?? true;\n  const { plugins, loadError } = opts;\n  const htmlLoader = plugins ? compose(plugins.map((plugin) => plugin.htmlLoader)) : defaultGetTemplate;\n  const jsExcludes = getEffectLoaders(\"jsExcludes\", plugins);\n  const cssExcludes = getEffectLoaders(\"cssExcludes\", plugins);\n  const jsIgnores = getEffectLoaders(\"jsIgnores\", plugins);\n  const cssIgnores = getEffectLoaders(\"cssIgnores\", plugins);\n  const getPublicPath = defaultGetPublicPath;\n\n  const getHtmlParseResult = (url, html, htmlLoader) =>\n    (html\n      ? Promise.resolve(html)\n      : fetch(url)\n          .then((response) => {\n            if (response.status >= 400) {\n              error(WUJIE_TIPS_HTML_ERROR_REQUESTED, { url, response });\n              loadError?.(url, new Error(WUJIE_TIPS_HTML_ERROR_REQUESTED));\n              return \"\";\n            }\n            return response.text();\n          })\n          .catch((e) => {\n            embedHTMLCache[url] = null;\n            loadError?.(url, e);\n            return Promise.reject(e);\n          })\n    ).then((html) => {\n      const assetPublicPath = getPublicPath(url);\n      const { template, scripts, styles } = processTpl(htmlLoader(html), assetPublicPath);\n      return {\n        template: template,\n        assetPublicPath,\n        getExternalScripts: () =>\n          getExternalScripts(\n            scripts\n              .filter((script) => !script.src || !isMatchUrl(script.src, jsExcludes))\n              .map((script) => ({ ...script, ignore: script.src && isMatchUrl(script.src, jsIgnores) })),\n            fetch,\n            loadError,\n            fiber\n          ),\n        getExternalStyleSheets: () =>\n          getExternalStyleSheets(\n            styles\n              .filter((style) => !style.src || !isMatchUrl(style.src, cssExcludes))\n              .map((style) => ({ ...style, ignore: style.src && isMatchUrl(style.src, cssIgnores) })),\n            fetch,\n            loadError\n          ),\n      };\n    });\n\n  if (opts?.plugins.some((plugin) => plugin.htmlLoader)) {\n    return getHtmlParseResult(url, html, htmlLoader);\n    // 没有html-loader可以做缓存\n  } else {\n    return embedHTMLCache[url] || (embedHTMLCache[url] = getHtmlParseResult(url, html, htmlLoader));\n  }\n}\n"],"mappings":"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"}