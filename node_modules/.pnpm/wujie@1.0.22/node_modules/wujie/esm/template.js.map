{"version":3,"file":"template.js","names":["getInlineCode","ALL_SCRIPT_REGEX","SCRIPT_TAG_REGEX","SCRIPT_SRC_REGEX","SCRIPT_TYPE_REGEX","SCRIPT_ENTRY_REGEX","SCRIPT_ASYNC_REGEX","DEFER_ASYNC_REGEX","SCRIPT_NO_MODULE_REGEX","SCRIPT_MODULE_REGEX","LINK_TAG_REGEX","LINK_PRELOAD_OR_PREFETCH_REGEX","LINK_HREF_REGEX","LINK_AS_FONT","STYLE_TAG_REGEX","STYLE_TYPE_REGEX","STYLE_HREF_REGEX","HTML_COMMENT_REGEX","LINK_IGNORE_REGEX","STYLE_IGNORE_REGEX","SCRIPT_IGNORE_REGEX","CROSS_ORIGIN_REGEX","hasProtocol","url","startsWith","getEntirePath","path","baseURI","URL","toString","isValidJavaScriptType","type","handleTypes","indexOf","parseTagAttributes","TagOuterHTML","pattern","matches","exec","attributesString","attributesPattern","attributesObject","attributeMatches","attributeName","attributeValue","isModuleScriptSupported","s","window","document","createElement","genLinkReplaceSymbol","linkHref","preloadOrPrefetch","arguments","length","undefined","concat","getInlineStyleReplaceSymbol","index","genScriptReplaceSymbol","scriptSrc","inlineScriptReplaceSymbol","genIgnoreAssetReplaceSymbol","genModuleScriptReplaceSymbol","moduleSupport","processTpl","tpl","postProcessTemplate","scripts","styles","entry","template","replace","match","styleType","styleHref","styleIgnore","href","newHref","push","src","preloadOrPrefetchType","_match$match","_match$match2","_slicedToArray","test","code","content","scriptTag","scriptIgnore","isModuleScript","isCrossOriginScript","crossOriginType","moduleScriptIgnore","matchedScriptTypeMatch","matchedScriptType","matchedScriptEntry","matchedScriptSrcMatch","matchedScriptSrc","SyntaxError","isAsyncScript","isDeferScript","async","defer","module","crossorigin","crossoriginType","attrs","isPureCommentBlock","split","every","line","trim","tplResult"],"sources":["../src/template.ts"],"sourcesContent":["import { getInlineCode } from \"./utils\";\n\nconst ALL_SCRIPT_REGEX = /(<script[\\s\\S]*?>)[\\s\\S]*?<\\/script>/gi;\nconst SCRIPT_TAG_REGEX = /<(script)\\s+((?!type=('|\")text\\/ng-template\\3).)*?>.*?<\\/\\1>/is;\nconst SCRIPT_SRC_REGEX = /.*\\ssrc=('|\")?([^>'\"\\s]+)/;\nconst SCRIPT_TYPE_REGEX = /.*\\stype=('|\")?([^>'\"\\s]+)/;\nconst SCRIPT_ENTRY_REGEX = /.*\\sentry\\s*.*/;\nconst SCRIPT_ASYNC_REGEX = /.*\\sasync\\s*.*/;\nconst DEFER_ASYNC_REGEX = /.*\\sdefer\\s*.*/;\nconst SCRIPT_NO_MODULE_REGEX = /.*\\snomodule\\s*.*/;\nconst SCRIPT_MODULE_REGEX = /.*\\stype=('|\")?module('|\")?\\s*.*/;\nconst LINK_TAG_REGEX = /<(link)\\s+.*?>/gis;\nconst LINK_PRELOAD_OR_PREFETCH_REGEX = /\\srel=('|\")?(preload|prefetch|modulepreload)\\1/;\nconst LINK_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\nconst LINK_AS_FONT = /.*\\sas=('|\")?font\\1.*/;\nconst STYLE_TAG_REGEX = /<style[^>]*>[\\s\\S]*?<\\/style>/gi;\nconst STYLE_TYPE_REGEX = /\\s+rel=('|\")?stylesheet\\1.*/;\nconst STYLE_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\nconst HTML_COMMENT_REGEX = /<!--([\\s\\S]*?)-->/g;\nconst LINK_IGNORE_REGEX = /<link(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\nconst STYLE_IGNORE_REGEX = /<style(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\nconst SCRIPT_IGNORE_REGEX = /<script(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\nconst CROSS_ORIGIN_REGEX = /.*\\scrossorigin=?('|\")?(use-credentials|anonymous)?('|\")?/i;\n\nexport type ScriptAttributes = {\n  [key: string]: string | boolean; // 所有属性都可以是字符串或布尔值类型\n};\n/** 脚本对象 */\nexport interface ScriptBaseObject {\n  /** 脚本地址，内联为空 */\n  src?: string;\n  /** 脚本是否为async执行 */\n  async?: boolean;\n  /** 脚本是否为defer执行 */\n  defer?: boolean;\n  /** 脚本是否为module模块 */\n  module?: boolean;\n  /** 脚本是否设置crossorigin */\n  crossorigin?: boolean;\n  /** 脚本crossorigin的类型 */\n  crossoriginType?: \"anonymous\" | \"use-credentials\" | \"\";\n  /** 脚本正则匹配属性 */\n  attrs?: ScriptAttributes;\n}\nexport type ScriptObject = ScriptBaseObject & {\n  /** 内联script的代码 */\n  content?: string;\n  /** 忽略，子应用自行请求 */\n  ignore?: boolean;\n  /** 子应用加载完毕事件 */\n  onload?: Function;\n};\n\n/** 样式对象 */\nexport interface StyleObject {\n  /** 样式地址， 内联为空 */\n  src?: string;\n  /** 样式代码 */\n  content?: string;\n  /** 忽略，子应用自行请求 */\n  ignore?: boolean;\n}\n\nexport interface TemplateResult {\n  template: string;\n  scripts: ScriptObject[];\n  styles: StyleObject[];\n  entry: string | ScriptObject;\n}\n\nfunction hasProtocol(url) {\n  return url.startsWith(\"//\") || url.startsWith(\"http://\") || url.startsWith(\"https://\");\n}\n\nfunction getEntirePath(path, baseURI) {\n  return new URL(path, baseURI).toString();\n}\n\nfunction isValidJavaScriptType(type) {\n  const handleTypes = [\n    \"text/javascript\",\n    \"module\",\n    \"application/javascript\",\n    \"text/ecmascript\",\n    \"application/ecmascript\",\n  ];\n  return !type || handleTypes.indexOf(type) !== -1;\n}\n\n/**\n * 解析标签的属性\n * @param scriptOuterHTML script 标签的 outerHTML\n * @returns 返回一个对象，包含 script 标签的所有属性\n */\nexport function parseTagAttributes(TagOuterHTML) {\n  const pattern = /<[-\\w]+\\s+([^>]*)>/i;\n  const matches = pattern.exec(TagOuterHTML);\n\n  if (!matches) {\n    return {};\n  }\n\n  const attributesString = matches[1];\n  const attributesPattern = /([^\\s=]+)\\s*=\\s*(['\"])(.*?)\\2/g;\n  const attributesObject = {};\n\n  let attributeMatches;\n  while ((attributeMatches = attributesPattern.exec(attributesString)) !== null) {\n    const attributeName = attributeMatches[1];\n    const attributeValue = attributeMatches[3];\n    attributesObject[attributeName] = attributeValue;\n  }\n\n  return attributesObject;\n}\n\nfunction isModuleScriptSupported() {\n  const s = window.document.createElement(\"script\");\n  return \"noModule\" in s;\n}\n\nexport const genLinkReplaceSymbol = (linkHref, preloadOrPrefetch = false) =>\n  `<!-- ${preloadOrPrefetch ? \"prefetch/preload/modulepreload\" : \"\"} link ${linkHref} replaced by wujie -->`;\nexport const getInlineStyleReplaceSymbol = (index) => `<!-- inline-style-${index} replaced by wujie -->`;\nexport const genScriptReplaceSymbol = (scriptSrc, type = \"\") =>\n  `<!-- ${type} script ${scriptSrc} replaced by wujie -->`;\nexport const inlineScriptReplaceSymbol = \"<!-- inline scripts replaced by wujie -->\";\nexport const genIgnoreAssetReplaceSymbol = (url) => `<!-- ignore asset ${url || \"file\"} replaced by wujie -->`;\nexport const genModuleScriptReplaceSymbol = (scriptSrc, moduleSupport) =>\n  `<!-- ${moduleSupport ? \"nomodule\" : \"module\"} script ${scriptSrc} ignored by wujie -->`;\n\n/**\n * parse the script link from the template\n * 1. collect stylesheets\n * 2. use global eval to evaluate the inline scripts\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function#Difference_between_Function_constructor_and_function_declaration\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#Do_not_ever_use_eval!\n * @param tpl\n * @param baseURI\n * @stripStyles whether to strip the css links\n * @returns {{template: void | string | *, scripts: *[], entry: *}}\n */\nexport default function processTpl(tpl: String, baseURI: String, postProcessTemplate?: Function): TemplateResult {\n  const scripts: ScriptObject[] = [];\n  const styles: StyleObject[] = [];\n  let entry = null;\n  const moduleSupport = isModuleScriptSupported();\n  const template = tpl\n\n    /*\n     remove html comment first\n     */\n    .replace(HTML_COMMENT_REGEX, \"\")\n\n    .replace(LINK_TAG_REGEX, (match) => {\n      /*\n       change the css link\n       */\n      const styleType = !!match.match(STYLE_TYPE_REGEX);\n      if (styleType) {\n        const styleHref = match.match(STYLE_HREF_REGEX);\n        const styleIgnore = match.match(LINK_IGNORE_REGEX);\n\n        if (styleHref) {\n          const href = styleHref && styleHref[2];\n          let newHref = href;\n\n          if (href && !hasProtocol(href)) {\n            newHref = getEntirePath(href, baseURI);\n          }\n          if (styleIgnore) {\n            return genIgnoreAssetReplaceSymbol(newHref);\n          }\n\n          styles.push({ src: newHref });\n          return genLinkReplaceSymbol(newHref);\n        }\n      }\n\n      const preloadOrPrefetchType =\n        match.match(LINK_PRELOAD_OR_PREFETCH_REGEX) && match.match(LINK_HREF_REGEX) && !match.match(LINK_AS_FONT);\n      if (preloadOrPrefetchType) {\n        const [, , linkHref] = match.match(LINK_HREF_REGEX);\n        return genLinkReplaceSymbol(linkHref, true);\n      }\n\n      return match;\n    })\n    .replace(STYLE_TAG_REGEX, (match) => {\n      if (STYLE_IGNORE_REGEX.test(match)) {\n        return genIgnoreAssetReplaceSymbol(\"style file\");\n      } else {\n        const code = getInlineCode(match);\n        styles.push({ src: \"\", content: code });\n        return getInlineStyleReplaceSymbol(styles.length - 1);\n      }\n    })\n    .replace(ALL_SCRIPT_REGEX, (match, scriptTag) => {\n      const scriptIgnore = scriptTag.match(SCRIPT_IGNORE_REGEX);\n      const isModuleScript = !!scriptTag.match(SCRIPT_MODULE_REGEX);\n      const isCrossOriginScript = scriptTag.match(CROSS_ORIGIN_REGEX);\n      const crossOriginType = isCrossOriginScript?.[2] || \"\";\n      const moduleScriptIgnore =\n        (moduleSupport && !!scriptTag.match(SCRIPT_NO_MODULE_REGEX)) || (!moduleSupport && isModuleScript);\n      // in order to keep the exec order of all javascripts\n\n      const matchedScriptTypeMatch = scriptTag.match(SCRIPT_TYPE_REGEX);\n      const matchedScriptType = matchedScriptTypeMatch && matchedScriptTypeMatch[2];\n      if (!isValidJavaScriptType(matchedScriptType)) {\n        return match;\n      }\n\n      // if it is a external script\n      if (SCRIPT_TAG_REGEX.test(match) && scriptTag.match(SCRIPT_SRC_REGEX)) {\n        /*\n         collect scripts and replace the ref\n         */\n\n        const matchedScriptEntry = scriptTag.match(SCRIPT_ENTRY_REGEX);\n        const matchedScriptSrcMatch = scriptTag.match(SCRIPT_SRC_REGEX);\n        let matchedScriptSrc = matchedScriptSrcMatch && matchedScriptSrcMatch[2];\n\n        if (entry && matchedScriptEntry) {\n          throw new SyntaxError(\"You should not set multiply entry script!\");\n        } else {\n          // append the domain while the script not have an protocol prefix\n          if (matchedScriptSrc && !hasProtocol(matchedScriptSrc)) {\n            matchedScriptSrc = getEntirePath(matchedScriptSrc, baseURI);\n          }\n\n          entry = entry || (matchedScriptEntry && matchedScriptSrc);\n        }\n\n        if (scriptIgnore) {\n          return genIgnoreAssetReplaceSymbol(matchedScriptSrc || \"js file\");\n        }\n\n        if (moduleScriptIgnore) {\n          return genModuleScriptReplaceSymbol(matchedScriptSrc || \"js file\", moduleSupport);\n        }\n\n        if (matchedScriptSrc) {\n          const isAsyncScript = !!scriptTag.match(SCRIPT_ASYNC_REGEX);\n          const isDeferScript = !!scriptTag.match(DEFER_ASYNC_REGEX);\n          scripts.push(\n            isAsyncScript || isDeferScript\n              ? {\n                  async: isAsyncScript,\n                  defer: isDeferScript,\n                  src: matchedScriptSrc,\n                  module: isModuleScript,\n                  crossorigin: !!isCrossOriginScript,\n                  crossoriginType: crossOriginType,\n                  attrs: parseTagAttributes(match),\n                }\n              : {\n                  src: matchedScriptSrc,\n                  module: isModuleScript,\n                  crossorigin: !!isCrossOriginScript,\n                  crossoriginType: crossOriginType,\n                  attrs: parseTagAttributes(match),\n                }\n          );\n          return genScriptReplaceSymbol(\n            matchedScriptSrc,\n            (isAsyncScript && \"async\") || (isDeferScript && \"defer\") || \"\"\n          );\n        }\n\n        return match;\n      } else {\n        if (scriptIgnore) {\n          return genIgnoreAssetReplaceSymbol(\"js file\");\n        }\n\n        if (moduleScriptIgnore) {\n          return genModuleScriptReplaceSymbol(\"js file\", moduleSupport);\n        }\n\n        // if it is an inline script\n        const code = getInlineCode(match);\n\n        // remove script blocks when all of these lines are comments.\n        const isPureCommentBlock = code.split(/[\\r\\n]+/).every((line) => !line.trim() || line.trim().startsWith(\"//\"));\n\n        if (!isPureCommentBlock && code) {\n          scripts.push({\n            src: \"\",\n            content: code,\n            module: isModuleScript,\n            crossorigin: !!isCrossOriginScript,\n            crossoriginType: crossOriginType,\n            attrs: parseTagAttributes(match),\n          });\n        }\n\n        return inlineScriptReplaceSymbol;\n      }\n    });\n\n  let tplResult = {\n    template,\n    scripts,\n    styles,\n    // set the last script as entry if have not set\n    entry: entry || scripts[scripts.length - 1],\n  };\n  if (typeof postProcessTemplate === \"function\") {\n    tplResult = postProcessTemplate(tplResult);\n  }\n\n  return tplResult;\n}\n"],"mappings":"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"}